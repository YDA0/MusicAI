{"ast":null,"code":"import { Monophonic } from \"./Monophonic\";\nimport { MonoSynth } from \"./MonoSynth\";\nimport { Signal } from \"../signal/Signal\";\nimport { readOnly } from \"../core/util/Interface\";\nimport { LFO } from \"../source/oscillator/LFO\";\nimport { Gain } from \"../core/context/Gain\";\nimport { Multiply } from \"../signal/Multiply\";\nimport { deepMerge, omitFromObject, optionsFromArguments } from \"../core/util/Defaults\";\n/**\n * DuoSynth is a monophonic synth composed of two [[MonoSynths]] run in parallel with control over the\n * frequency ratio between the two voices and vibrato effect.\n * @example\n * const duoSynth = new Tone.DuoSynth().toDestination();\n * duoSynth.triggerAttackRelease(\"C4\", \"2n\");\n * @category Instrument\n */\nexport class DuoSynth extends Monophonic {\n  constructor() {\n    super(optionsFromArguments(DuoSynth.getDefaults(), arguments));\n    this.name = \"DuoSynth\";\n    const options = optionsFromArguments(DuoSynth.getDefaults(), arguments);\n    this.voice0 = new MonoSynth(Object.assign(options.voice0, {\n      context: this.context,\n      onsilence: () => this.onsilence(this)\n    }));\n    this.voice1 = new MonoSynth(Object.assign(options.voice1, {\n      context: this.context\n    }));\n    this.harmonicity = new Multiply({\n      context: this.context,\n      units: \"positive\",\n      value: options.harmonicity\n    });\n    this._vibrato = new LFO({\n      frequency: options.vibratoRate,\n      context: this.context,\n      min: -50,\n      max: 50\n    });\n    // start the vibrato immediately\n    this._vibrato.start();\n    this.vibratoRate = this._vibrato.frequency;\n    this._vibratoGain = new Gain({\n      context: this.context,\n      units: \"normalRange\",\n      gain: options.vibratoAmount\n    });\n    this.vibratoAmount = this._vibratoGain.gain;\n    this.frequency = new Signal({\n      context: this.context,\n      units: \"frequency\",\n      value: 440\n    });\n    this.detune = new Signal({\n      context: this.context,\n      units: \"cents\",\n      value: options.detune\n    });\n    // control the two voices frequency\n    this.frequency.connect(this.voice0.frequency);\n    this.frequency.chain(this.harmonicity, this.voice1.frequency);\n    this._vibrato.connect(this._vibratoGain);\n    this._vibratoGain.fan(this.voice0.detune, this.voice1.detune);\n    this.detune.fan(this.voice0.detune, this.voice1.detune);\n    this.voice0.connect(this.output);\n    this.voice1.connect(this.output);\n    readOnly(this, [\"voice0\", \"voice1\", \"frequency\", \"vibratoAmount\", \"vibratoRate\"]);\n  }\n  getLevelAtTime(time) {\n    time = this.toSeconds(time);\n    return this.voice0.envelope.getValueAtTime(time) + this.voice1.envelope.getValueAtTime(time);\n  }\n  static getDefaults() {\n    return deepMerge(Monophonic.getDefaults(), {\n      vibratoAmount: 0.5,\n      vibratoRate: 5,\n      harmonicity: 1.5,\n      voice0: deepMerge(omitFromObject(MonoSynth.getDefaults(), Object.keys(Monophonic.getDefaults())), {\n        filterEnvelope: {\n          attack: 0.01,\n          decay: 0.0,\n          sustain: 1,\n          release: 0.5\n        },\n        envelope: {\n          attack: 0.01,\n          decay: 0.0,\n          sustain: 1,\n          release: 0.5\n        }\n      }),\n      voice1: deepMerge(omitFromObject(MonoSynth.getDefaults(), Object.keys(Monophonic.getDefaults())), {\n        filterEnvelope: {\n          attack: 0.01,\n          decay: 0.0,\n          sustain: 1,\n          release: 0.5\n        },\n        envelope: {\n          attack: 0.01,\n          decay: 0.0,\n          sustain: 1,\n          release: 0.5\n        }\n      })\n    });\n  }\n  /**\n   * Trigger the attack portion of the note\n   */\n  _triggerEnvelopeAttack(time, velocity) {\n    // @ts-ignore\n    this.voice0._triggerEnvelopeAttack(time, velocity);\n    // @ts-ignore\n    this.voice1._triggerEnvelopeAttack(time, velocity);\n  }\n  /**\n   * Trigger the release portion of the note\n   */\n  _triggerEnvelopeRelease(time) {\n    // @ts-ignore\n    this.voice0._triggerEnvelopeRelease(time);\n    // @ts-ignore\n    this.voice1._triggerEnvelopeRelease(time);\n    return this;\n  }\n  dispose() {\n    super.dispose();\n    this.voice0.dispose();\n    this.voice1.dispose();\n    this.frequency.dispose();\n    this.detune.dispose();\n    this._vibrato.dispose();\n    this.vibratoRate.dispose();\n    this._vibratoGain.dispose();\n    this.harmonicity.dispose();\n    return this;\n  }\n}","map":{"version":3,"names":["Monophonic","MonoSynth","Signal","readOnly","LFO","Gain","Multiply","deepMerge","omitFromObject","optionsFromArguments","DuoSynth","constructor","getDefaults","arguments","name","options","voice0","Object","assign","context","onsilence","voice1","harmonicity","units","value","_vibrato","frequency","vibratoRate","min","max","start","_vibratoGain","gain","vibratoAmount","detune","connect","chain","fan","output","getLevelAtTime","time","toSeconds","envelope","getValueAtTime","keys","filterEnvelope","attack","decay","sustain","release","_triggerEnvelopeAttack","velocity","_triggerEnvelopeRelease","dispose"],"sources":["../../../Tone/instrument/DuoSynth.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}