{"ast":null,"code":"import { StereoEffect } from \"./StereoEffect\";\nimport { optionsFromArguments } from \"../core/util/Defaults\";\nimport { readOnly } from \"../core/util/Interface\";\nimport { Signal } from \"../signal/Signal\";\nimport { LowpassCombFilter } from \"../component/filter/LowpassCombFilter\";\n/**\n * An array of comb filter delay values from Freeverb implementation\n */\nconst combFilterTunings = [1557 / 44100, 1617 / 44100, 1491 / 44100, 1422 / 44100, 1277 / 44100, 1356 / 44100, 1188 / 44100, 1116 / 44100];\n/**\n * An array of allpass filter frequency values from Freeverb implementation\n */\nconst allpassFilterFrequencies = [225, 556, 441, 341];\n/**\n * Freeverb is a reverb based on [Freeverb](https://ccrma.stanford.edu/~jos/pasp/Freeverb.html).\n * Read more on reverb on [Sound On Sound](https://web.archive.org/web/20160404083902/http://www.soundonsound.com:80/sos/feb01/articles/synthsecrets.asp).\n * Freeverb is now implemented with an AudioWorkletNode which may result on performance degradation on some platforms. Consider using [[Reverb]].\n * @example\n * const freeverb = new Tone.Freeverb().toDestination();\n * freeverb.dampening = 1000;\n * // routing synth through the reverb\n * const synth = new Tone.NoiseSynth().connect(freeverb);\n * synth.triggerAttackRelease(0.05);\n * @category Effect\n */\nexport class Freeverb extends StereoEffect {\n  constructor() {\n    super(optionsFromArguments(Freeverb.getDefaults(), arguments, [\"roomSize\", \"dampening\"]));\n    this.name = \"Freeverb\";\n    /**\n     * the comb filters\n     */\n    this._combFilters = [];\n    /**\n     * the allpass filters on the left\n     */\n    this._allpassFiltersL = [];\n    /**\n     * the allpass filters on the right\n     */\n    this._allpassFiltersR = [];\n    const options = optionsFromArguments(Freeverb.getDefaults(), arguments, [\"roomSize\", \"dampening\"]);\n    this.roomSize = new Signal({\n      context: this.context,\n      value: options.roomSize,\n      units: \"normalRange\"\n    });\n    // make the allpass filters on the right\n    this._allpassFiltersL = allpassFilterFrequencies.map(freq => {\n      const allpassL = this.context.createBiquadFilter();\n      allpassL.type = \"allpass\";\n      allpassL.frequency.value = freq;\n      return allpassL;\n    });\n    // make the allpass filters on the left\n    this._allpassFiltersR = allpassFilterFrequencies.map(freq => {\n      const allpassR = this.context.createBiquadFilter();\n      allpassR.type = \"allpass\";\n      allpassR.frequency.value = freq;\n      return allpassR;\n    });\n    // make the comb filters\n    this._combFilters = combFilterTunings.map((delayTime, index) => {\n      const lfpf = new LowpassCombFilter({\n        context: this.context,\n        dampening: options.dampening,\n        delayTime\n      });\n      if (index < combFilterTunings.length / 2) {\n        this.connectEffectLeft(lfpf, ...this._allpassFiltersL);\n      } else {\n        this.connectEffectRight(lfpf, ...this._allpassFiltersR);\n      }\n      this.roomSize.connect(lfpf.resonance);\n      return lfpf;\n    });\n    readOnly(this, [\"roomSize\"]);\n  }\n  static getDefaults() {\n    return Object.assign(StereoEffect.getDefaults(), {\n      roomSize: 0.7,\n      dampening: 3000\n    });\n  }\n  /**\n   * The amount of dampening of the reverberant signal.\n   */\n  get dampening() {\n    return this._combFilters[0].dampening;\n  }\n  set dampening(d) {\n    this._combFilters.forEach(c => c.dampening = d);\n  }\n  dispose() {\n    super.dispose();\n    this._allpassFiltersL.forEach(al => al.disconnect());\n    this._allpassFiltersR.forEach(ar => ar.disconnect());\n    this._combFilters.forEach(cf => cf.dispose());\n    this.roomSize.dispose();\n    return this;\n  }\n}","map":{"version":3,"names":["StereoEffect","optionsFromArguments","readOnly","Signal","LowpassCombFilter","combFilterTunings","allpassFilterFrequencies","Freeverb","constructor","getDefaults","arguments","name","_combFilters","_allpassFiltersL","_allpassFiltersR","options","roomSize","context","value","units","map","freq","allpassL","createBiquadFilter","type","frequency","allpassR","delayTime","index","lfpf","dampening","length","connectEffectLeft","connectEffectRight","connect","resonance","Object","assign","d","forEach","c","dispose","al","disconnect","ar","cf"],"sources":["../../../Tone/effect/Freeverb.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}